"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),DepartmentApp=function(){function e(t){_classCallCheck(this,e),this.props=Object.assign({},e.defaults,t),this.searchBarInput=document.querySelector(this.props.searchBarInput),this.searchBarClearBtn=document.querySelector(this.props.searchBarClearBtn),this.departmentList=document.querySelector(this.props.departmentList),this.departmentBlock=document.querySelector(this.props.departmentBlock),this.locationEl=this.departmentBlock.querySelector(this.props.locationEl),this.addressEl=this.departmentBlock.querySelector(this.props.addressEl),this.emailEl=this.departmentBlock.querySelector(this.props.emailEl),this.phoneEl=this.departmentBlock.querySelector(this.props.phoneEl),this.mapBlock=document.querySelector(this.props.mapBlock),this.displaySearchQuery=this.displaySearchQuery.bind(this),this.renderDepartmentList=this._debounce(this.renderDepartmentList.bind(this),1e3),this.renderChoosedDepartment=this.renderChoosedDepartment.bind(this),this.createDepartmentBlock=this.createDepartmentBlock.bind(this),this.initMap=this.initMap.bind(this),this.clearInput=this.clearInput.bind(this),this._bindEvents()}return _createClass(e,[{key:"displaySearchQuery",value:function(e){console.log("displaySearchQuery"),this.departmentBlock.classList.add("department-block--display-none"),this.mapBlock.classList.add("department-map--display-none");var t=e.target.value,a="https://api.privatbank.ua/p24api/pboffice?json&address="+t;0===t.length?(this.searchBarClearBtn.classList.add("search-bar__icon-clear--display-none"),this.clearDepartmentList()):(this.searchBarClearBtn.classList.remove("search-bar__icon-clear--display-none"),this.renderDepartmentList(a))}},{key:"renderDepartmentList",value:function(e){var t=this;console.log("renderDepartmentList"),console.log(this.departmentList),fetch(e).then(function(e){return e.json()}).then(function(e){console.log(e),t.clearDepartmentList();for(var a in e)if(a<10){var s=document.createElement("li");s.classList.add("department-list__item"),s.addEventListener("click",t.renderChoosedDepartment),s.innerHTML='<i class="material-icons search-bar__icon-search  noUserSelect">search</i>',s.innerHTML+=e[a].address,s.setAttribute("data-city",e[a].city),s.setAttribute("data-country",e[a].country),s.setAttribute("data-address",e[a].address),s.setAttribute("data-email",e[a].email),s.setAttribute("data-phone",e[a].phone),s.setAttribute("data-name",e[a].name),t.departmentList.appendChild(s)}}).catch(function(e){console.log(e.message)})}},{key:"renderChoosedDepartment",value:function(e){console.log("renderChoosedDepartment"),this.searchBarInput.value=e.target.dataset.address;var t=e.target.dataset.city+", "+e.target.dataset.address;this.clearDepartmentList(),this.createDepartmentBlock(e.target.dataset),this.initMap(t)}},{key:"createDepartmentBlock",value:function(e){console.log("createDepartmentBlockваппвапва"),e.country&&(this.locationEl.innerHTML='<i class="material-icons department-block__icon UserSelect">location_city</i>',this.locationEl.innerHTML+=e.country),e.city&&(this.locationEl.innerHTML+=", "+e.city),e.address&&(this.addressEl.innerHTML='<i class="material-icons department-block__icon UserSelect">place</i>',this.addressEl.innerHTML+=e.address),e.email&&(this.emailEl.innerHTML='<i class="material-icons department-block__icon UserSelect">email</i>',this.emailEl.innerHTML+=e.email),e.phone&&(this.phoneEl.innerHTML='<i class="material-icons department-block__icon UserSelect">phone</i>',this.phoneEl.innerHTML+=e.phone),this.departmentBlock.classList.remove("department-block--display-none"),this.mapBlock.classList.remove("department-map--display-none")}},{key:"clearInput",value:function(){this.searchBarClearBtn.classList.add("search-bar__icon-clear--display-none"),this.departmentBlock.classList.add("department-block--display-none"),this.mapBlock.classList.add("department-map--display-none"),this.searchBarInput.value="",this.clearDepartmentList(),this.searchBarInput.focus()}},{key:"initMap",value:function(e){var t=e,a=new google.maps.Geocoder,s={zoom:10,center:new google.maps.LatLng(50.27,30.3),mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(this.mapBlock,s);a&&a.geocode({address:t},function(e,a){if(a==google.maps.GeocoderStatus.OK)if(a!=google.maps.GeocoderStatus.ZERO_RESULTS){n.setCenter(e[0].geometry.location);var s=new google.maps.InfoWindow({content:"<b>"+t+"</b>",size:new google.maps.Size(150,50)}),r=new google.maps.Marker({position:e[0].geometry.location,map:n,title:t});google.maps.event.addListener(r,"click",function(){s.open(n,r)})}else console.log("No results found");else console.log("Geocode was not successful for the following reason: "+a)})}},{key:"clearDepartmentList",value:function(){for(console.log("clearDepartmentList");this.departmentList.firstChild;)this.departmentList.removeChild(this.departmentList.firstChild)}},{key:"_debounce",value:function(e,t,a){var s=void 0;return function(){var n=this,r=arguments;clearTimeout(s),s=setTimeout(function(){s=null,a||e.apply(n,r)},t)}}},{key:"_bindEvents",value:function(){this.searchBarInput.addEventListener("keyup",this.displaySearchQuery),this.searchBarClearBtn.addEventListener("click",this.clearInput)}}]),e}();DepartmentApp.defaults={searchBarInput:".search-bar__input",searchBarClearBtn:".search-bar__icon-clear",departmentList:".depatment-list",departmentBlock:".department-block",mapBlock:".department-map",locationEl:"#location",addressEl:"#address",emailEl:"#email",phoneEl:"#phone"},new DepartmentApp;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiRGVwYXJ0bWVudEFwcCIsInByb3BzIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIk9iamVjdCIsImFzc2lnbiIsImRlZmF1bHRzIiwic2VhcmNoQmFySW5wdXQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZWFyY2hCYXJDbGVhckJ0biIsImRlcGFydG1lbnRMaXN0IiwiZGVwYXJ0bWVudEJsb2NrIiwibG9jYXRpb25FbCIsImFkZHJlc3NFbCIsImVtYWlsRWwiLCJwaG9uZUVsIiwicmVuZGVyRGVwYXJ0bWVudExpc3QiLCJiaW5kIiwiX2JpbmRFdmVudHMiLCJyZW5kZXJDaG9vc2VkRGVwYXJ0bWVudCIsImNvbnNvbGUiLCJjcmVhdGVEZXBhcnRtZW50QmxvY2siLCJpbml0TWFwIiwiY2xlYXJJbnB1dCIsImFkcmVzc0lucHV0VmFsdWUiLCJlIiwidGFyZ2V0IiwidmFsdWUiLCJzZWFyY2hVcmwiLCJsZW5ndGgiLCJjbGFzc0xpc3QiLCJhZGQiLCJjbGVhckRlcGFydG1lbnRMaXN0IiwibWFwQmxvY2siLCJfdGhpcyIsImxvZyIsInRoZW4iLCJyZXNwb25zZSIsImRhdGEiLCJrZXkiLCJkZXBhcnRtZW50IiwiY3JlYXRlRWxlbWVudCIsImNvdW50cnlEYXRhIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImNpdHkiLCJzZXRBdHRyaWJ1dGUiLCJjb3VudHJ5IiwiZW1haWwiLCJwaG9uZSIsIm5hbWUiLCJhcHBlbmRDaGlsZCIsImNob29zZWREZXBhcnRtZW50RnVsbEFkZHJlc3MiLCJkYXRhc2V0IiwicmVtb3ZlIiwiZ29vZ2xlQWRkcmVzcyIsImdlb2NvZGVyIiwiZ29vZ2xlIiwibWFwcyIsIkdlb2NvZGVyIiwibXlPcHRpb25zIiwiem9vbSIsImNlbnRlciIsIm1hcFR5cGVDb250cm9sIiwibWFwVHlwZUNvbnRyb2xPcHRpb25zIiwic3R5bGUiLCJNYXBUeXBlQ29udHJvbFN0eWxlIiwiRFJPUERPV05fTUVOVSIsIm5hdmlnYXRpb25Db250cm9sIiwibWFwVHlwZUlkIiwibWFwIiwiZ2VvY29kZSIsImxhdGxuZyIsInN0YXR1cyIsIkdlb2NvZGVyU3RhdHVzIiwiT0siLCJzZXRDZW50ZXIiLCJyZXN1bHRzIiwiZ2VvbWV0cnkiLCJsb2NhdGlvbiIsIk1hcFR5cGVJZCIsIlJPQURNQVAiLCJjb250ZW50IiwiU2l6ZSIsIk1hcmtlciIsInBvc2l0aW9uIiwiaW5mb3dpbmRvdyIsIm9wZW4iLCJtYXJrZXIiLCJmaXJzdENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJmdW5jIiwid2FpdCIsImltbWVkaWF0ZSIsInRpbWVvdXQiLCJjb250ZXh0IiwiYXJncyIsImFyZ3VtZW50cyIsImNsZWFyVGltZW91dCIsInNldFRpbWVvdXQiLCJhcHBseSIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNwbGF5U2VhcmNoUXVlcnkiLCJjYWxsTm93Il0sIm1hcHBpbmdzIjoiNlhBQU1BLHlCQUNKLFNBQUFBLEVBQVlDLEdBQU9DLGdCQUFBQyxLQUFBSCxHQUNqQkcsS0FBS0YsTUFBUUcsT0FBT0MsVUFBV0wsRUFBY00sU0FBVUwsR0FFdkRFLEtBQUtJLGVBQWlCQyxTQUFTQyxjQUFjTixLQUFLRixNQUFNTSxnQkFDeERKLEtBQUtPLGtCQUFvQkYsU0FBU0MsY0FBY04sS0FBS0YsTUFBTVMsbUJBTHpEVixLQUFBQSxlQU1vQlEsU0FBU0MsY0FBY04sS0FBS0YsTUFBTVUsZ0JBTDFEUixLQUFBUyxnQkFBWVgsU0FBT1EsY0FBQU4sS0FBQUYsTUFBQVcsaUJBQUFULEtBQUFVLFdBQUFWLEtBQUFTLGdCQUFBSCxjQUFBTixLQUFBRixNQUFBWSxZQVFqQlYsS0FBS1csVUFBWVgsS0FBS1MsZ0JBQWdCSCxjQUFjTixLQUFLRixNQUFNYSxXQVAvRFgsS0FBS0YsUUFBUUcsS0FBT0MsZ0JBQVdMLGNBQWNNLEtBQVVMLE1BQXZEYyxTQVNBWixLQUFLYSxRQUFVYixLQUFLUyxnQkFBZ0JILGNBQWNOLEtBQUtGLE1BQU1lLFNBUDdEYixLQUFLSSxTQUFB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QUFXQyxLQUFLakIsRUFBS2tCLFVBWHFCcEUsUUFBNUNlLElBQUEseUJBTUVrRCxRQUFBQSxJQUFBQSx3REFEa0NaLG1EQVVwQ3JELElBRERBLFFBQUFlLElBakJELHVCQWtCRWYsS0FBQUEsZUFBWXFFLFlBQ2J2RixLQUFBUSxlQUFBZ0YsWUFBQXhGLEtBQUFRLGVBQUErRSw4Q0F2QkxFLEVBQUFDLEVBQUFDLEdBNEJELElBQUFDLE9BQUFBLEVBQ0YsT0FBQSxXQVlDLElBQUlDLEVBQVU3RixLQUFNOEYsRUFBT0MsVUFOMUJDLGFBQUFKLEdBQ0ZBLEVBQUFLLFdBTWEsV0FDWEwsRUFBVSxLQVhYMUUsR0FBWXVFLEVBQUFTLE1BQUFMLEVBQVpDLElBSURKLDBDQUlBMUYsS0FBQUksZUFBTytGLGlCQUFXLFFBQUFuRyxLQUFBb0csb0JBQ2pCcEcsS0FBQU8sa0JBQUE0RixpQkFBQSxRQUFBbkcsS0FBQXFCLHFCQUdDeEIsY0FBSU0sVUFDSkMsZUFIRCxxQkFJQUcsa0JBQUk4RiwwQkFDSkwsZUFBQUEsa0JBQ0FKLGdCQUFVSyxvQkFDVmxFLFNBVEQsa0JBVUFyQixXQUFBLFlBZURDLFVBQVcsV0FDWEMsUUFBUyxTQUNUQyxRQUFTLFVBWlIsSUFBQWhCIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBEZXBhcnRtZW50QXBwIHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICB0aGlzLnByb3BzID0gT2JqZWN0LmFzc2lnbih7fSwgRGVwYXJ0bWVudEFwcC5kZWZhdWx0cywgcHJvcHMpO1xuXG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5zZWFyY2hCYXJJbnB1dCk7XG4gICAgdGhpcy5zZWFyY2hCYXJDbGVhckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5zZWFyY2hCYXJDbGVhckJ0bik7XG4gICAgdGhpcy5kZXBhcnRtZW50TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5kZXBhcnRtZW50TGlzdCk7XG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuZGVwYXJ0bWVudEJsb2NrKTtcbiAgICB0aGlzLmxvY2F0aW9uRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMubG9jYXRpb25FbCk7XG4gICAgdGhpcy5hZGRyZXNzRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuYWRkcmVzc0VsKTtcbiAgICB0aGlzLmVtYWlsRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuZW1haWxFbCk7XG4gICAgdGhpcy5waG9uZUVsID0gdGhpcy5kZXBhcnRtZW50QmxvY2sucXVlcnlTZWxlY3Rvcih0aGlzLnByb3BzLnBob25lRWwpO1xuICAgIHRoaXMubWFwQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMubWFwQmxvY2spO1xuXG4gICAgdGhpcy5kaXNwbGF5U2VhcmNoUXVlcnkgPSB0aGlzLmRpc3BsYXlTZWFyY2hRdWVyeS5iaW5kKHRoaXMpO1xuICAgIHRoaXMucmVuZGVyRGVwYXJ0bWVudExpc3QgPSB0aGlzLl9kZWJvdW5jZSh0aGlzLnJlbmRlckRlcGFydG1lbnRMaXN0LmJpbmQodGhpcyksIDEwMDApO1xuICAgIHRoaXMucmVuZGVyQ2hvb3NlZERlcGFydG1lbnQgPSB0aGlzLnJlbmRlckNob29zZWREZXBhcnRtZW50LmJpbmQodGhpcyk7XG4gICAgdGhpcy5jcmVhdGVEZXBhcnRtZW50QmxvY2sgPSB0aGlzLmNyZWF0ZURlcGFydG1lbnRCbG9jay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaW5pdE1hcCA9IHRoaXMuaW5pdE1hcC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuY2xlYXJJbnB1dCA9IHRoaXMuY2xlYXJJbnB1dC5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5fYmluZEV2ZW50cygpO1xuICB9XG5cbiAgZGlzcGxheVNlYXJjaFF1ZXJ5KGUpIHtcbiAgICBjb25zb2xlLmxvZygnZGlzcGxheVNlYXJjaFF1ZXJ5Jyk7XG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2suY2xhc3NMaXN0LmFkZCgnZGVwYXJ0bWVudC1ibG9jay0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5tYXBCbG9jay5jbGFzc0xpc3QuYWRkKCdkZXBhcnRtZW50LW1hcC0tZGlzcGxheS1ub25lJyk7XG5cbiAgICBsZXQgYWRyZXNzSW5wdXRWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlO1xuICAgIGxldCBzZWFyY2hVcmwgPSAnaHR0cHM6Ly9hcGkucHJpdmF0YmFuay51YS9wMjRhcGkvcGJvZmZpY2U/anNvbiZhZGRyZXNzPScgKyBhZHJlc3NJbnB1dFZhbHVlO1xuXG4gICAgaWYgKGFkcmVzc0lucHV0VmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLnNlYXJjaEJhckNsZWFyQnRuLmNsYXNzTGlzdC5hZGQoJ3NlYXJjaC1iYXJfX2ljb24tY2xlYXItLWRpc3BsYXktbm9uZScpO1xuICAgICAgdGhpcy5jbGVhckRlcGFydG1lbnRMaXN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VhcmNoQmFyQ2xlYXJCdG4uY2xhc3NMaXN0LnJlbW92ZSgnc2VhcmNoLWJhcl9faWNvbi1jbGVhci0tZGlzcGxheS1ub25lJyk7XG4gICAgICB0aGlzLnJlbmRlckRlcGFydG1lbnRMaXN0KHNlYXJjaFVybCk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyRGVwYXJ0bWVudExpc3Qoc2VhcmNoVXJsKSB7XG4gICAgY29uc29sZS5sb2coJ3JlbmRlckRlcGFydG1lbnRMaXN0Jyk7XG4gICAgY29uc29sZS5sb2codGhpcy5kZXBhcnRtZW50TGlzdCk7XG4gICAgY29uc3QgY291bnRyeURhdGEgID0gZmV0Y2goc2VhcmNoVXJsKTtcbiAgICBjb3VudHJ5RGF0YVxuICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSlcbiAgICAgIC50aGVuKGRhdGEgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgdGhpcy5jbGVhckRlcGFydG1lbnRMaXN0KCk7XG4gICAgICAgIGZvcihsZXQga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICBpZiAoa2V5IDwgMTApIHtcbiAgICAgICAgICAgIGxldCBkZXBhcnRtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgICAgICAgIGRlcGFydG1lbnQuY2xhc3NMaXN0LmFkZCgnZGVwYXJ0bWVudC1saXN0X19pdGVtJyk7XG4gICAgICAgICAgICBkZXBhcnRtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5yZW5kZXJDaG9vc2VkRGVwYXJ0bWVudCk7XG4gICAgICAgICAgICBkZXBhcnRtZW50LmlubmVySFRNTCA9ICc8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIHNlYXJjaC1iYXJfX2ljb24tc2VhcmNoICBub1VzZXJTZWxlY3RcIj5zZWFyY2g8L2k+JztcbiAgICAgICAgICAgIGRlcGFydG1lbnQuaW5uZXJIVE1MICs9IGRhdGFba2V5XS5hZGRyZXNzO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtY2l0eScsIGRhdGFba2V5XS5jaXR5KTtcbiAgICAgICAgICAgIGRlcGFydG1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNvdW50cnknLCBkYXRhW2tleV0uY291bnRyeSk7XG4gICAgICAgICAgICBkZXBhcnRtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1hZGRyZXNzJywgZGF0YVtrZXldLmFkZHJlc3MpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtZW1haWwnLCBkYXRhW2tleV0uZW1haWwpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtcGhvbmUnLCBkYXRhW2tleV0ucGhvbmUpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtbmFtZScsIGRhdGFba2V5XS5uYW1lKTtcbiAgICAgICAgICAgIHRoaXMuZGVwYXJ0bWVudExpc3QuYXBwZW5kQ2hpbGQoZGVwYXJ0bWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IubWVzc2FnZSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHJlbmRlckNob29zZWREZXBhcnRtZW50KGUpIHtcbiAgICBjb25zb2xlLmxvZygncmVuZGVyQ2hvb3NlZERlcGFydG1lbnQnKTtcbiAgICB0aGlzLnNlYXJjaEJhcklucHV0LnZhbHVlID0gZS50YXJnZXQuZGF0YXNldC5hZGRyZXNzO1xuICAgIGxldCBjaG9vc2VkRGVwYXJ0bWVudEZ1bGxBZGRyZXNzID1cbiAgICAgIGUudGFyZ2V0LmRhdGFzZXQuY2l0eSArICcsICcgK1xuICAgICAgZS50YXJnZXQuZGF0YXNldC5hZGRyZXNzO1xuICAgIHRoaXMuY2xlYXJEZXBhcnRtZW50TGlzdCgpO1xuICAgIHRoaXMuY3JlYXRlRGVwYXJ0bWVudEJsb2NrKGUudGFyZ2V0LmRhdGFzZXQpO1xuICAgIHRoaXMuaW5pdE1hcChjaG9vc2VkRGVwYXJ0bWVudEZ1bGxBZGRyZXNzKTtcbiAgfVxuXG4gIGNyZWF0ZURlcGFydG1lbnRCbG9jayhkYXRhc2V0KSB7XG4gICAgY29uc29sZS5sb2coJ2NyZWF0ZURlcGFydG1lbnRCbG9ja9Cy0LDQv9C/0LLQsNC/0LLQsCcpO1xuICAgIGlmIChkYXRhc2V0LmNvdW50cnkpIHtcbiAgICAgIHRoaXMubG9jYXRpb25FbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5sb2NhdGlvbl9jaXR5PC9pPic7XG4gICAgICB0aGlzLmxvY2F0aW9uRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQuY291bnRyeTtcbiAgICB9XG4gICAgaWYgKGRhdGFzZXQuY2l0eSkge1xuICAgICAgdGhpcy5sb2NhdGlvbkVsLmlubmVySFRNTCArPSAnLCAnICsgZGF0YXNldC5jaXR5O1xuICAgIH1cbiAgICBpZiAoZGF0YXNldC5hZGRyZXNzKSB7XG4gICAgICB0aGlzLmFkZHJlc3NFbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5wbGFjZTwvaT4nO1xuICAgICAgdGhpcy5hZGRyZXNzRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQuYWRkcmVzcztcbiAgICB9XG4gICAgaWYgKGRhdGFzZXQuZW1haWwpIHtcbiAgICAgIHRoaXMuZW1haWxFbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5lbWFpbDwvaT4nO1xuICAgICAgdGhpcy5lbWFpbEVsLmlubmVySFRNTCArPSBkYXRhc2V0LmVtYWlsO1xuICAgIH1cbiAgICBpZiAoZGF0YXNldC5waG9uZSkge1xuICAgICAgdGhpcy5waG9uZUVsLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIGRlcGFydG1lbnQtYmxvY2tfX2ljb24gVXNlclNlbGVjdFwiPnBob25lPC9pPic7XG4gICAgICB0aGlzLnBob25lRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQucGhvbmU7XG4gICAgfVxuXG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnZGVwYXJ0bWVudC1ibG9jay0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5tYXBCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdkZXBhcnRtZW50LW1hcC0tZGlzcGxheS1ub25lJyk7XG4gIH1cblxuICBjbGVhcklucHV0KCkge1xuICAgIHRoaXMuc2VhcmNoQmFyQ2xlYXJCdG4uY2xhc3NMaXN0LmFkZCgnc2VhcmNoLWJhcl9faWNvbi1jbGVhci0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2suY2xhc3NMaXN0LmFkZCgnZGVwYXJ0bWVudC1ibG9jay0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5tYXBCbG9jay5jbGFzc0xpc3QuYWRkKCdkZXBhcnRtZW50LW1hcC0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHRoaXMuY2xlYXJEZXBhcnRtZW50TGlzdCgpO1xuICAgIHRoaXMuc2VhcmNoQmFySW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIGluaXRNYXAoY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcykge1xuICAgIGxldCBnb29nbGVBZGRyZXNzID0gY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcztcbiAgICBsZXQgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcbiAgICBsZXQgbGF0bG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg1MC4yNywgMzAuMzApO1xuICAgIGxldCBteU9wdGlvbnMgPSB7XG4gICAgICB6b29tOiAxMCxcbiAgICAgIGNlbnRlcjogbGF0bG5nLFxuICAgICAgbWFwVHlwZUNvbnRyb2w6IHRydWUsXG4gICAgICBtYXBUeXBlQ29udHJvbE9wdGlvbnM6IHtcbiAgICAgICAgc3R5bGU6IGdvb2dsZS5tYXBzLk1hcFR5cGVDb250cm9sU3R5bGUuRFJPUERPV05fTUVOVVxuICAgICAgfSxcbiAgICAgIG5hdmlnYXRpb25Db250cm9sOiB0cnVlLFxuICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUFxuICAgIH07XG4gICAgbGV0IG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAodGhpcy5tYXBCbG9jaywgbXlPcHRpb25zKTtcblxuICAgIGlmIChnZW9jb2Rlcikge1xuICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7XG4gICAgICAgICdhZGRyZXNzJzogZ29vZ2xlQWRkcmVzc1xuICAgICAgfSwgZnVuY3Rpb24ocmVzdWx0cywgc3RhdHVzKSB7XG4gICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcbiAgICAgICAgICBpZiAoc3RhdHVzICE9IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLlpFUk9fUkVTVUxUUykge1xuICAgICAgICAgICAgbWFwLnNldENlbnRlcihyZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICAgICAgICAgIGNvbnRlbnQ6ICc8Yj4nICsgZ29vZ2xlQWRkcmVzcyArICc8L2I+JyxcbiAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTUwLCA1MClcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uLFxuICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgdGl0bGU6IGdvb2dsZUFkZHJlc3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTm8gcmVzdWx0cyBmb3VuZFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJHZW9jb2RlIHdhcyBub3Qgc3VjY2Vzc2Z1bCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb246IFwiICtzdGF0dXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjbGVhckRlcGFydG1lbnRMaXN0KCkge1xuICAgIGNvbnNvbGUubG9nKCdjbGVhckRlcGFydG1lbnRMaXN0Jyk7XG4gICAgd2hpbGUgKHRoaXMuZGVwYXJ0bWVudExpc3QuZmlyc3RDaGlsZCkge1xuICAgICAgICB0aGlzLmRlcGFydG1lbnRMaXN0LnJlbW92ZUNoaWxkKHRoaXMuZGVwYXJ0bWVudExpc3QuZmlyc3RDaGlsZCk7XG4gICAgfVxuICB9XG5cbiAgX2RlYm91bmNlKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkge1xuICBcdGxldCB0aW1lb3V0O1xuICBcdHJldHVybiBmdW5jdGlvbigpIHtcbiAgXHRcdGxldCBjb250ZXh0ID0gdGhpcywgYXJncyA9IGFyZ3VtZW50cztcbiAgXHRcdGxldCBsYXRlciA9IGZ1bmN0aW9uKCkge1xuICBcdFx0XHR0aW1lb3V0ID0gbnVsbDtcbiAgXHRcdFx0aWYgKCFpbW1lZGlhdGUpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gIFx0XHR9O1xuICBcdFx0bGV0IGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XG4gIFx0XHRjbGVhclRpbWVvdXQodGltZW91dCk7XG4gIFx0XHR0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gIFx0fTtcbiAgfTtcblxuICBfYmluZEV2ZW50cygpIHtcbiAgICB0aGlzLnNlYXJjaEJhcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgdGhpcy5kaXNwbGF5U2VhcmNoUXVlcnkpO1xuICAgIHRoaXMuc2VhcmNoQmFyQ2xlYXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsZWFySW5wdXQpO1xuICB9XG59XG5cbkRlcGFydG1lbnRBcHAuZGVmYXVsdHMgPSB7XG4gIHNlYXJjaEJhcklucHV0OiAnLnNlYXJjaC1iYXJfX2lucHV0JyxcbiAgc2VhcmNoQmFyQ2xlYXJCdG46ICcuc2VhcmNoLWJhcl9faWNvbi1jbGVhcicsXG4gIGRlcGFydG1lbnRMaXN0OiAnLmRlcGF0bWVudC1saXN0JyxcbiAgZGVwYXJ0bWVudEJsb2NrOiAnLmRlcGFydG1lbnQtYmxvY2snLFxuICBtYXBCbG9jazogJy5kZXBhcnRtZW50LW1hcCcsXG4gIGxvY2F0aW9uRWw6ICcjbG9jYXRpb24nLFxuICBhZGRyZXNzRWw6ICcjYWRkcmVzcycsXG4gIGVtYWlsRWw6ICcjZW1haWwnLFxuICBwaG9uZUVsOiAnI3Bob25lJ1xufVxuXG5uZXcgRGVwYXJ0bWVudEFwcCgpOyJdfQ==
