"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),DepartmentApp=function(){function e(t){_classCallCheck(this,e),this.props=Object.assign({},e.defaults,t),this.searchBarInput=document.querySelector(this.props.searchBarInput),this.searchBarClearBtn=document.querySelector(this.props.searchBarClearBtn),this.departmentList=document.querySelector(this.props.departmentList),this.departmentBlock=document.querySelector(this.props.departmentBlock),this.locationEl=this.departmentBlock.querySelector(this.props.locationEl),this.addressEl=this.departmentBlock.querySelector(this.props.addressEl),this.emailEl=this.departmentBlock.querySelector(this.props.emailEl),this.phoneEl=this.departmentBlock.querySelector(this.props.phoneEl),this.mapBlock=document.querySelector(this.props.mapBlock),this.displaySearchQuery=this.displaySearchQuery.bind(this),this.renderDepartmentList=this._debounce(this.renderDepartmentList.bind(this),1e3),this.renderChoosedDepartment=this.renderChoosedDepartment.bind(this),this.createDepartmentBlock=this.createDepartmentBlock.bind(this),this.initMap=this.initMap.bind(this),this.clearInput=this.clearInput.bind(this),this._bindEvents()}return _createClass(e,[{key:"displaySearchQuery",value:function(e){this.departmentBlock.classList.add("department-block--display-none"),this.mapBlock.classList.add("department-map--display-none");var t=e.target.value,a="https://api.privatbank.ua/p24api/pboffice?json&address="+t;0===t.length?(this.searchBarClearBtn.classList.add("search-bar__icon-clear--display-none"),this.clearDepartmentList()):(this.searchBarClearBtn.classList.remove("search-bar__icon-clear--display-none"),this.renderDepartmentList(a))}},{key:"renderDepartmentList",value:function(e){var t=this;fetch(e).then(function(e){return e.json()}).then(function(e){t.clearDepartmentList();for(var a in e)if(a<10){var s=document.createElement("li");s.classList.add("department-list__item"),s.addEventListener("click",t.renderChoosedDepartment),s.innerHTML='<i class="material-icons search-bar__icon-search  noUserSelect">search</i>',s.innerHTML+=e[a].address,s.setAttribute("data-city",e[a].city),s.setAttribute("data-country",e[a].country),s.setAttribute("data-address",e[a].address),s.setAttribute("data-email",e[a].email),s.setAttribute("data-phone",e[a].phone),s.setAttribute("data-name",e[a].name),t.departmentList.appendChild(s)}}).catch(function(e){console.log(e.message)})}},{key:"renderChoosedDepartment",value:function(e){this.searchBarInput.value=e.target.dataset.address;var t=e.target.dataset.city+", "+e.target.dataset.address;this.clearDepartmentList(),this.createDepartmentBlock(e.target.dataset),this.initMap(t)}},{key:"createDepartmentBlock",value:function(e){e.country&&(this.locationEl.innerHTML='<i class="material-icons department-block__icon UserSelect">location_city</i>',this.locationEl.innerHTML+=e.country),e.city&&(this.locationEl.innerHTML+=", "+e.city),e.address&&(this.addressEl.innerHTML='<i class="material-icons department-block__icon UserSelect">place</i>',this.addressEl.innerHTML+=e.address),e.email&&(this.emailEl.innerHTML='<i class="material-icons department-block__icon UserSelect">email</i>',this.emailEl.innerHTML+=e.email),e.phone&&(this.phoneEl.innerHTML='<i class="material-icons department-block__icon UserSelect">phone</i>',this.phoneEl.innerHTML+=e.phone),this.departmentBlock.classList.remove("department-block--display-none"),this.mapBlock.classList.remove("department-map--display-none")}},{key:"clearInput",value:function(){this.searchBarClearBtn.classList.add("search-bar__icon-clear--display-none"),this.departmentBlock.classList.add("department-block--display-none"),this.mapBlock.classList.add("department-map--display-none"),this.searchBarInput.value="",this.clearDepartmentList(),this.searchBarInput.focus()}},{key:"initMap",value:function(e){var t=e,a=new google.maps.Geocoder,s={zoom:10,center:new google.maps.LatLng(50.27,30.3),mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},n=new google.maps.Map(this.mapBlock,s);a&&a.geocode({address:t},function(e,a){if(a==google.maps.GeocoderStatus.OK)if(a!=google.maps.GeocoderStatus.ZERO_RESULTS){n.setCenter(e[0].geometry.location);var s=new google.maps.InfoWindow({content:"<b>"+t+"</b>",size:new google.maps.Size(150,50)}),r=new google.maps.Marker({position:e[0].geometry.location,map:n,title:t});google.maps.event.addListener(r,"click",function(){s.open(n,r)})}else console.log("No results found");else console.log("Geocode was not successful for the following reason: "+a)})}},{key:"clearDepartmentList",value:function(){for(;this.departmentList.firstChild;)this.departmentList.removeChild(this.departmentList.firstChild)}},{key:"_debounce",value:function(e,t,a){var s=void 0;return function(){var n=this,r=arguments;clearTimeout(s),s=setTimeout(function(){s=null,a||e.apply(n,r)},t)}}},{key:"_bindEvents",value:function(){this.searchBarInput.addEventListener("keyup",this.displaySearchQuery),this.searchBarClearBtn.addEventListener("click",this.clearInput)}}]),e}();DepartmentApp.defaults={searchBarInput:".search-bar__input",searchBarClearBtn:".search-bar__icon-clear",departmentList:".depatment-list",departmentBlock:".department-block",mapBlock:".department-map",locationEl:"#location",addressEl:"#address",emailEl:"#email",phoneEl:"#phone"},new DepartmentApp;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiRGVwYXJ0bWVudEFwcCIsInByb3BzIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsIk9iamVjdCIsImFzc2lnbiIsImRlZmF1bHRzIiwic2VhcmNoQmFySW5wdXQiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJzZWFyY2hCYXJDbGVhckJ0biIsImRlcGFydG1lbnRMaXN0IiwiZGVwYXJ0bWVudEJsb2NrIiwibG9jYXRpb25FbCIsImFkZHJlc3NFbCIsImVtYWlsRWwiLCJwaG9uZUVsIiwicmVuZGVyRGVwYXJ0bWVudExpc3QiLCJiaW5kIiwiX2JpbmRFdmVudHMiLCJyZW5kZXJDaG9vc2VkRGVwYXJ0bWVudCIsImNyZWF0ZURlcGFydG1lbnRCbG9jayIsImFkZCIsImluaXRNYXAiLCJjbGFzc0xpc3QiLCJhZHJlc3NJbnB1dFZhbHVlIiwiZSIsInRhcmdldCIsInZhbHVlIiwic2VhcmNoVXJsIiwibGVuZ3RoIiwiY2xlYXJEZXBhcnRtZW50TGlzdCIsIm1hcEJsb2NrIiwiX3RoaXMiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsImtleSIsImRlcGFydG1lbnQiLCJjcmVhdGVFbGVtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImlubmVySFRNTCIsImNvdW50cnlEYXRhIiwiYWRkcmVzcyIsInNldEF0dHJpYnV0ZSIsImNpdHkiLCJjb3VudHJ5IiwiZW1haWwiLCJwaG9uZSIsIm5hbWUiLCJkYXRhc2V0IiwiY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcyIsImNhdGNoIiwiY29uc29sZSIsIm1lc3NhZ2UiLCJyZW1vdmUiLCJnb29nbGVBZGRyZXNzIiwiZ2VvY29kZXIiLCJnb29nbGUiLCJtYXBzIiwiR2VvY29kZXIiLCJteU9wdGlvbnMiLCJ6b29tIiwiY2VudGVyIiwibWFwVHlwZUNvbnRyb2wiLCJtYXBUeXBlQ29udHJvbE9wdGlvbnMiLCJzdHlsZSIsIk1hcFR5cGVDb250cm9sU3R5bGUiLCJEUk9QRE9XTl9NRU5VIiwibmF2aWdhdGlvbkNvbnRyb2wiLCJtYXBUeXBlSWQiLCJtYXAiLCJnZW9jb2RlIiwibGF0bG5nIiwic3RhdHVzIiwiR2VvY29kZXJTdGF0dXMiLCJPSyIsInNldENlbnRlciIsInJlc3VsdHMiLCJnZW9tZXRyeSIsImxvY2F0aW9uIiwiTWFwVHlwZUlkIiwiUk9BRE1BUCIsImNvbnRlbnQiLCJTaXplIiwiTWFya2VyIiwicG9zaXRpb24iLCJpbmZvd2luZG93Iiwib3BlbiIsIm1hcmtlciIsImxvZyIsImZpcnN0Q2hpbGQiLCJyZW1vdmVDaGlsZCIsImZ1bmMiLCJ3YWl0IiwiaW1tZWRpYXRlIiwidGltZW91dCIsImNvbnRleHQiLCJhcmdzIiwiYXJndW1lbnRzIiwiY2xlYXJUaW1lb3V0Iiwic2V0VGltZW91dCIsImFwcGx5IiwiZGlzcGxheVNlYXJjaFF1ZXJ5IiwiY2xlYXJJbnB1dCIsImNhbGxOb3ciXSwibWFwcGluZ3MiOiI2WEFBTUEseUJBQ0osU0FBQUEsRUFBWUMsR0FBT0MsZ0JBQUFDLEtBQUFILEdBQ2pCRyxLQUFLRixNQUFRRyxPQUFPQyxVQUFXTCxFQUFjTSxTQUFVTCxHQUV2REUsS0FBS0ksZUFBaUJDLFNBQVNDLGNBQWNOLEtBQUtGLE1BQU1NLGdCQUN4REosS0FBS08sa0JBQW9CRixTQUFTQyxjQUFjTixLQUFLRixNQUFNUyxtQkFMekRWLEtBQUFBLGVBTW9CUSxTQUFTQyxjQUFjTixLQUFLRixNQUFNVSxnQkFMMURSLEtBQUFTLGdCQUFZWCxTQUFPUSxjQUFBTixLQUFBRixNQUFBVyxpQkFBQVQsS0FBQVUsV0FBQVYsS0FBQVMsZ0JBQUFILGNBQUFOLEtBQUFGLE1BQUFZLFlBUWpCVixLQUFLVyxVQUFZWCxLQUFLUyxnQkFBZ0JILGNBQWNOLEtBQUtGLE1BQU1hLFdBUC9EWCxLQUFLRixRQUFRRyxLQUFPQyxnQkFBV0wsY0FBY00sS0FBVUwsTUFBdkRjLFNBU0FaLEtBQUthLFFBQVViLEtBQUtTLGdCQUFnQkgsY0FBY04sS0FBS0YsTUFBTWUsU0FQN0Ri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WXVDLFlBQUExRixLQUFaUSxlQUFBaUYsOENBSUhFLEVBQUFDLEVBQUFDLEdBQ0YsSUFBQUMsT0FBQUEsRUFDRixPQUFBLFdBQ0YsSUFBQUMsRUFBQS9GLEtBQUFnRyxFQUFBQyxVQUtFQyxhQUFBSixHQUNGQSxFQUFBSyxXQU1hLFdBQ1hMLEVBQVUsS0FDTEQsR0FBV0YsRUFBS1MsTUFBTUwsRUFBU0MsSUFSdENKLDBDQUlBNUYsS0FBQUksZUFBT2tDLGlCQUFXLFFBQUF0QyxLQUFBcUcsb0JBQ2pCckcsS0FBQU8sa0JBQUErQixpQkFBQSxRQUFBdEMsS0FBQXNHLHFCQUdDekcsY0FBSU0sVUFDSkMsZUFIRCxxQkFJQUcsa0JBQUlnRywwQkFDSkwsZUFBQUEsa0JBQ0FKLGdCQUFVSyxvQkFDVnRFLFNBVEQsa0JBVUFuQixXQUFBLFlBZURDLFVBQVcsV0FDWEMsUUFBUyxTQUNUQyxRQUFTLFVBWlIsSUFBQWhCIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBEZXBhcnRtZW50QXBwIHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICB0aGlzLnByb3BzID0gT2JqZWN0LmFzc2lnbih7fSwgRGVwYXJ0bWVudEFwcC5kZWZhdWx0cywgcHJvcHMpO1xuXG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5zZWFyY2hCYXJJbnB1dCk7XG4gICAgdGhpcy5zZWFyY2hCYXJDbGVhckJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5zZWFyY2hCYXJDbGVhckJ0bik7XG4gICAgdGhpcy5kZXBhcnRtZW50TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5wcm9wcy5kZXBhcnRtZW50TGlzdCk7XG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuZGVwYXJ0bWVudEJsb2NrKTtcbiAgICB0aGlzLmxvY2F0aW9uRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMubG9jYXRpb25FbCk7XG4gICAgdGhpcy5hZGRyZXNzRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuYWRkcmVzc0VsKTtcbiAgICB0aGlzLmVtYWlsRWwgPSB0aGlzLmRlcGFydG1lbnRCbG9jay5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMuZW1haWxFbCk7XG4gICAgdGhpcy5waG9uZUVsID0gdGhpcy5kZXBhcnRtZW50QmxvY2sucXVlcnlTZWxlY3Rvcih0aGlzLnByb3BzLnBob25lRWwpO1xuICAgIHRoaXMubWFwQmxvY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMucHJvcHMubWFwQmxvY2spO1xuXG4gICAgdGhpcy5kaXNwbGF5U2VhcmNoUXVlcnkgPSB0aGlzLmRpc3BsYXlTZWFyY2hRdWVyeS5iaW5kKHRoaXMpO1xuICAgIHRoaXMucmVuZGVyRGVwYXJ0bWVudExpc3QgPSB0aGlzLl9kZWJvdW5jZSh0aGlzLnJlbmRlckRlcGFydG1lbnRMaXN0LmJpbmQodGhpcyksIDEwMDApO1xuICAgIHRoaXMucmVuZGVyQ2hvb3NlZERlcGFydG1lbnQgPSB0aGlzLnJlbmRlckNob29zZWREZXBhcnRtZW50LmJpbmQodGhpcyk7XG4gICAgdGhpcy5jcmVhdGVEZXBhcnRtZW50QmxvY2sgPSB0aGlzLmNyZWF0ZURlcGFydG1lbnRCbG9jay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaW5pdE1hcCA9IHRoaXMuaW5pdE1hcC5iaW5kKHRoaXMpO1xuICAgIHRoaXMuY2xlYXJJbnB1dCA9IHRoaXMuY2xlYXJJbnB1dC5iaW5kKHRoaXMpO1xuXG4gICAgdGhpcy5fYmluZEV2ZW50cygpO1xuICB9XG5cbiAgZGlzcGxheVNlYXJjaFF1ZXJ5KGUpIHtcbiAgICB0aGlzLmRlcGFydG1lbnRCbG9jay5jbGFzc0xpc3QuYWRkKCdkZXBhcnRtZW50LWJsb2NrLS1kaXNwbGF5LW5vbmUnKTtcbiAgICB0aGlzLm1hcEJsb2NrLmNsYXNzTGlzdC5hZGQoJ2RlcGFydG1lbnQtbWFwLS1kaXNwbGF5LW5vbmUnKTtcblxuICAgIGxldCBhZHJlc3NJbnB1dFZhbHVlID0gZS50YXJnZXQudmFsdWU7XG4gICAgbGV0IHNlYXJjaFVybCA9ICdodHRwczovL2FwaS5wcml2YXRiYW5rLnVhL3AyNGFwaS9wYm9mZmljZT9qc29uJmFkZHJlc3M9JyArIGFkcmVzc0lucHV0VmFsdWU7XG5cbiAgICBpZiAoYWRyZXNzSW5wdXRWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuc2VhcmNoQmFyQ2xlYXJCdG4uY2xhc3NMaXN0LmFkZCgnc2VhcmNoLWJhcl9faWNvbi1jbGVhci0tZGlzcGxheS1ub25lJyk7XG4gICAgICB0aGlzLmNsZWFyRGVwYXJ0bWVudExpc3QoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZWFyY2hCYXJDbGVhckJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdzZWFyY2gtYmFyX19pY29uLWNsZWFyLS1kaXNwbGF5LW5vbmUnKTtcbiAgICAgIHRoaXMucmVuZGVyRGVwYXJ0bWVudExpc3Qoc2VhcmNoVXJsKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXJEZXBhcnRtZW50TGlzdChzZWFyY2hVcmwpIHtcbiAgICBjb25zdCBjb3VudHJ5RGF0YSAgPSBmZXRjaChzZWFyY2hVcmwpO1xuICAgIGNvdW50cnlEYXRhXG4gICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9KVxuICAgICAgLnRoZW4oZGF0YSA9PiB7XG4gICAgICAgIHRoaXMuY2xlYXJEZXBhcnRtZW50TGlzdCgpO1xuICAgICAgICBmb3IobGV0IGtleSBpbiBkYXRhKSB7XG4gICAgICAgICAgaWYgKGtleSA8IDEwKSB7XG4gICAgICAgICAgICBsZXQgZGVwYXJ0bWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgICAgICBkZXBhcnRtZW50LmNsYXNzTGlzdC5hZGQoJ2RlcGFydG1lbnQtbGlzdF9faXRlbScpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMucmVuZGVyQ2hvb3NlZERlcGFydG1lbnQpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBzZWFyY2gtYmFyX19pY29uLXNlYXJjaCAgbm9Vc2VyU2VsZWN0XCI+c2VhcmNoPC9pPic7XG4gICAgICAgICAgICBkZXBhcnRtZW50LmlubmVySFRNTCArPSBkYXRhW2tleV0uYWRkcmVzcztcbiAgICAgICAgICAgIGRlcGFydG1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWNpdHknLCBkYXRhW2tleV0uY2l0eSk7XG4gICAgICAgICAgICBkZXBhcnRtZW50LnNldEF0dHJpYnV0ZSgnZGF0YS1jb3VudHJ5JywgZGF0YVtrZXldLmNvdW50cnkpO1xuICAgICAgICAgICAgZGVwYXJ0bWVudC5zZXRBdHRyaWJ1dGUoJ2RhdGEtYWRkcmVzcycsIGRhdGFba2V5XS5hZGRyZXNzKTtcbiAgICAgICAgICAgIGRlcGFydG1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLWVtYWlsJywgZGF0YVtrZXldLmVtYWlsKTtcbiAgICAgICAgICAgIGRlcGFydG1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLXBob25lJywgZGF0YVtrZXldLnBob25lKTtcbiAgICAgICAgICAgIGRlcGFydG1lbnQuc2V0QXR0cmlidXRlKCdkYXRhLW5hbWUnLCBkYXRhW2tleV0ubmFtZSk7XG4gICAgICAgICAgICB0aGlzLmRlcGFydG1lbnRMaXN0LmFwcGVuZENoaWxkKGRlcGFydG1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfSk7XG4gIH1cblxuICByZW5kZXJDaG9vc2VkRGVwYXJ0bWVudChlKSB7XG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dC52YWx1ZSA9IGUudGFyZ2V0LmRhdGFzZXQuYWRkcmVzcztcbiAgICBsZXQgY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcyA9XG4gICAgICBlLnRhcmdldC5kYXRhc2V0LmNpdHkgKyAnLCAnICtcbiAgICAgIGUudGFyZ2V0LmRhdGFzZXQuYWRkcmVzcztcbiAgICB0aGlzLmNsZWFyRGVwYXJ0bWVudExpc3QoKTtcbiAgICB0aGlzLmNyZWF0ZURlcGFydG1lbnRCbG9jayhlLnRhcmdldC5kYXRhc2V0KTtcbiAgICB0aGlzLmluaXRNYXAoY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcyk7XG4gIH1cblxuICBjcmVhdGVEZXBhcnRtZW50QmxvY2soZGF0YXNldCkge1xuICAgIGlmIChkYXRhc2V0LmNvdW50cnkpIHtcbiAgICAgIHRoaXMubG9jYXRpb25FbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5sb2NhdGlvbl9jaXR5PC9pPic7XG4gICAgICB0aGlzLmxvY2F0aW9uRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQuY291bnRyeTtcbiAgICB9XG4gICAgaWYgKGRhdGFzZXQuY2l0eSkge1xuICAgICAgdGhpcy5sb2NhdGlvbkVsLmlubmVySFRNTCArPSAnLCAnICsgZGF0YXNldC5jaXR5O1xuICAgIH1cbiAgICBpZiAoZGF0YXNldC5hZGRyZXNzKSB7XG4gICAgICB0aGlzLmFkZHJlc3NFbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5wbGFjZTwvaT4nO1xuICAgICAgdGhpcy5hZGRyZXNzRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQuYWRkcmVzcztcbiAgICB9XG4gICAgaWYgKGRhdGFzZXQuZW1haWwpIHtcbiAgICAgIHRoaXMuZW1haWxFbC5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJtYXRlcmlhbC1pY29ucyBkZXBhcnRtZW50LWJsb2NrX19pY29uIFVzZXJTZWxlY3RcIj5lbWFpbDwvaT4nO1xuICAgICAgdGhpcy5lbWFpbEVsLmlubmVySFRNTCArPSBkYXRhc2V0LmVtYWlsO1xuICAgIH1cbiAgICBpZiAoZGF0YXNldC5waG9uZSkge1xuICAgICAgdGhpcy5waG9uZUVsLmlubmVySFRNTCA9ICc8aSBjbGFzcz1cIm1hdGVyaWFsLWljb25zIGRlcGFydG1lbnQtYmxvY2tfX2ljb24gVXNlclNlbGVjdFwiPnBob25lPC9pPic7XG4gICAgICB0aGlzLnBob25lRWwuaW5uZXJIVE1MICs9IGRhdGFzZXQucGhvbmU7XG4gICAgfVxuXG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2suY2xhc3NMaXN0LnJlbW92ZSgnZGVwYXJ0bWVudC1ibG9jay0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5tYXBCbG9jay5jbGFzc0xpc3QucmVtb3ZlKCdkZXBhcnRtZW50LW1hcC0tZGlzcGxheS1ub25lJyk7XG4gIH1cblxuICBjbGVhcklucHV0KCkge1xuICAgIHRoaXMuc2VhcmNoQmFyQ2xlYXJCdG4uY2xhc3NMaXN0LmFkZCgnc2VhcmNoLWJhcl9faWNvbi1jbGVhci0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5kZXBhcnRtZW50QmxvY2suY2xhc3NMaXN0LmFkZCgnZGVwYXJ0bWVudC1ibG9jay0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5tYXBCbG9jay5jbGFzc0xpc3QuYWRkKCdkZXBhcnRtZW50LW1hcC0tZGlzcGxheS1ub25lJyk7XG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dC52YWx1ZSA9ICcnO1xuICAgIHRoaXMuY2xlYXJEZXBhcnRtZW50TGlzdCgpO1xuICAgIHRoaXMuc2VhcmNoQmFySW5wdXQuZm9jdXMoKTtcbiAgfVxuXG4gIGluaXRNYXAoY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcykge1xuICAgIGxldCBnb29nbGVBZGRyZXNzID0gY2hvb3NlZERlcGFydG1lbnRGdWxsQWRkcmVzcztcbiAgICBsZXQgZ2VvY29kZXIgPSBuZXcgZ29vZ2xlLm1hcHMuR2VvY29kZXIoKTtcbiAgICBsZXQgbGF0bG5nID0gbmV3IGdvb2dsZS5tYXBzLkxhdExuZyg1MC4yNywgMzAuMzApO1xuICAgIGxldCBteU9wdGlvbnMgPSB7XG4gICAgICB6b29tOiAxMCxcbiAgICAgIGNlbnRlcjogbGF0bG5nLFxuICAgICAgbWFwVHlwZUNvbnRyb2w6IHRydWUsXG4gICAgICBtYXBUeXBlQ29udHJvbE9wdGlvbnM6IHtcbiAgICAgICAgc3R5bGU6IGdvb2dsZS5tYXBzLk1hcFR5cGVDb250cm9sU3R5bGUuRFJPUERPV05fTUVOVVxuICAgICAgfSxcbiAgICAgIG5hdmlnYXRpb25Db250cm9sOiB0cnVlLFxuICAgICAgbWFwVHlwZUlkOiBnb29nbGUubWFwcy5NYXBUeXBlSWQuUk9BRE1BUFxuICAgIH07XG4gICAgbGV0IG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAodGhpcy5tYXBCbG9jaywgbXlPcHRpb25zKTtcblxuICAgIGlmIChnZW9jb2Rlcikge1xuICAgICAgZ2VvY29kZXIuZ2VvY29kZSh7XG4gICAgICAgICdhZGRyZXNzJzogZ29vZ2xlQWRkcmVzc1xuICAgICAgfSwgZnVuY3Rpb24ocmVzdWx0cywgc3RhdHVzKSB7XG4gICAgICAgIGlmIChzdGF0dXMgPT0gZ29vZ2xlLm1hcHMuR2VvY29kZXJTdGF0dXMuT0spIHtcbiAgICAgICAgICBpZiAoc3RhdHVzICE9IGdvb2dsZS5tYXBzLkdlb2NvZGVyU3RhdHVzLlpFUk9fUkVTVUxUUykge1xuICAgICAgICAgICAgbWFwLnNldENlbnRlcihyZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uKTtcblxuICAgICAgICAgICAgdmFyIGluZm93aW5kb3cgPSBuZXcgZ29vZ2xlLm1hcHMuSW5mb1dpbmRvdyh7XG4gICAgICAgICAgICAgIGNvbnRlbnQ6ICc8Yj4nICsgZ29vZ2xlQWRkcmVzcyArICc8L2I+JyxcbiAgICAgICAgICAgICAgc2l6ZTogbmV3IGdvb2dsZS5tYXBzLlNpemUoMTUwLCA1MClcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiByZXN1bHRzWzBdLmdlb21ldHJ5LmxvY2F0aW9uLFxuICAgICAgICAgICAgICBtYXA6IG1hcCxcbiAgICAgICAgICAgICAgdGl0bGU6IGdvb2dsZUFkZHJlc3NcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobWFya2VyLCAnY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaW5mb3dpbmRvdy5vcGVuKG1hcCwgbWFya2VyKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTm8gcmVzdWx0cyBmb3VuZFwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJHZW9jb2RlIHdhcyBub3Qgc3VjY2Vzc2Z1bCBmb3IgdGhlIGZvbGxvd2luZyByZWFzb246IFwiICtzdGF0dXMpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBjbGVhckRlcGFydG1lbnRMaXN0KCkge1xuICAgIHdoaWxlICh0aGlzLmRlcGFydG1lbnRMaXN0LmZpcnN0Q2hpbGQpIHtcbiAgICAgICAgdGhpcy5kZXBhcnRtZW50TGlzdC5yZW1vdmVDaGlsZCh0aGlzLmRlcGFydG1lbnRMaXN0LmZpcnN0Q2hpbGQpO1xuICAgIH1cbiAgfVxuXG4gIF9kZWJvdW5jZShmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHtcbiAgXHRsZXQgdGltZW91dDtcbiAgXHRyZXR1cm4gZnVuY3Rpb24oKSB7XG4gIFx0XHRsZXQgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7XG4gIFx0XHRsZXQgbGF0ZXIgPSBmdW5jdGlvbigpIHtcbiAgXHRcdFx0dGltZW91dCA9IG51bGw7XG4gIFx0XHRcdGlmICghaW1tZWRpYXRlKSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICBcdFx0fTtcbiAgXHRcdGxldCBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICBcdFx0Y2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICBcdFx0dGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xuICBcdH07XG4gIH07XG5cbiAgX2JpbmRFdmVudHMoKSB7XG4gICAgdGhpcy5zZWFyY2hCYXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMuZGlzcGxheVNlYXJjaFF1ZXJ5KTtcbiAgICB0aGlzLnNlYXJjaEJhckNsZWFyQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGVhcklucHV0KTtcbiAgfVxufVxuXG5EZXBhcnRtZW50QXBwLmRlZmF1bHRzID0ge1xuICBzZWFyY2hCYXJJbnB1dDogJy5zZWFyY2gtYmFyX19pbnB1dCcsXG4gIHNlYXJjaEJhckNsZWFyQnRuOiAnLnNlYXJjaC1iYXJfX2ljb24tY2xlYXInLFxuICBkZXBhcnRtZW50TGlzdDogJy5kZXBhdG1lbnQtbGlzdCcsXG4gIGRlcGFydG1lbnRCbG9jazogJy5kZXBhcnRtZW50LWJsb2NrJyxcbiAgbWFwQmxvY2s6ICcuZGVwYXJ0bWVudC1tYXAnLFxuICBsb2NhdGlvbkVsOiAnI2xvY2F0aW9uJyxcbiAgYWRkcmVzc0VsOiAnI2FkZHJlc3MnLFxuICBlbWFpbEVsOiAnI2VtYWlsJyxcbiAgcGhvbmVFbDogJyNwaG9uZSdcbn1cblxubmV3IERlcGFydG1lbnRBcHAoKTsiXX0=
